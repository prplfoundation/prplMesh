
sudo: required
dist: xenial
language: python2.7

services:
  - docker

script:
  - cd tools/docker
  # Try to pull from dockerhub, build the container images if that fails
  - sudo ./image-pull.sh || sudo ./image-build.sh
  # Run clang-format and check there are no modified files by checking git status
  - sudo ./clang-format.sh
  - git diff-index --exit-code HEAD
  - sudo ./build.sh map -f CMAKE_BUILD_TYPE=Debug BUILD_TESTS=ON
  # Check that the AutoGenerated files are correct by checking git status
  - git update-index -q --refresh
  - git diff-index --exit-code HEAD
  # Tests
  - ./run.sh --entrypoint "$PWD/../../../build/install/bin/tests/tlvf_test"
  - ./tests/test_flows.sh -v topology
