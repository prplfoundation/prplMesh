
sudo: required
dist: xenial
language: python2.7

services:
  - docker

script:
  - cd tools/docker
  - sudo ./image-build.sh -b ubuntu:18.04
  - sudo ./build.sh map -f CMAKE_BUILD_TYPE=Debug BUILD_TESTS=ON
  # Start controller & agent node detached and check status
  - sudo ./run.sh start-controller-agent -d -n controller-agent
  - sudo ./run.sh start-agent -d -n agent
  - sleep 5
  - sudo ./test.sh -v -n controller-agent
  # Remote agent doesn't get to operational YET, so don't fail the build on that
  - sudo ./test.sh -v -n agent || true
  # Check that the AutoGenerated files are correct by checking git status
  - git update-index -q --refresh
  - git diff-index --exit-code HEAD

